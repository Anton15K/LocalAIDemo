<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/base :: html(pageTitle='Recommended Problems', currentPage='lectures', content=~{::content})}">
<body>
<div th:fragment="content">
    <!-- Header -->
    <div class="mb-6">
        <nav class="flex mb-4" aria-label="Breadcrumb">
            <ol class="flex items-center space-x-2">
                <li><a href="/lectures" class="text-gray-500 hover:text-gray-700">Lectures</a></li>
                <li><span class="text-gray-400">/</span></li>
                <li><a th:href="@{/lectures/{id}(id=${lecture.id})}" class="text-gray-500 hover:text-gray-700" th:text="${lecture.title}">Lecture</a></li>
                <li><span class="text-gray-400">/</span></li>
                <li class="text-gray-900 font-medium">Recommended Problems</li>
            </ol>
        </nav>
        <div class="flex items-start justify-between">
            <div>
                <h1 class="text-2xl font-bold text-gray-900">Recommended Problems</h1>
                <p class="mt-1 text-sm text-gray-600">
                    For: <span class="font-medium" th:text="${lecture.title}">Lecture</span>
                </p>
            </div>
            <a th:href="@{/lectures/{id}(id=${lecture.id})}" class="px-4 py-2 bg-gray-100 text-gray-700 rounded-md hover:bg-gray-200 transition text-sm">
                Back to Lecture
            </a>
        </div>
    </div>

    <div th:if="${#lists.isEmpty(problems.content)}" class="bg-white rounded-lg shadow p-10 text-center">
        <h3 class="text-sm font-medium text-gray-900">No problems found</h3>
        <p class="mt-1 text-sm text-gray-500">Try re-analyzing the lecture or increasing topK.</p>
    </div>

    <div th:unless="${#lists.isEmpty(problems.content)}" class="space-y-4">
        <div th:each="result : ${problems.content}" class="bg-white rounded-lg shadow p-5">
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1">
                    <div class="flex flex-wrap items-center gap-2 mb-2">
                        <span class="px-2 py-1 bg-indigo-100 text-indigo-800 rounded-full text-xs font-medium" th:text="${result.problem.topic}">Topic</span>
                        <span th:if="${result.problem.subtopic}" class="px-2 py-1 bg-gray-100 text-gray-700 rounded-full text-xs" th:text="${result.problem.subtopic}">Subtopic</span>
                        <span th:if="${result.problem.difficulty}" class="text-xs text-gray-400" th:text="'Level ' + ${result.problem.difficulty}">Level</span>
                        <span th:if="${result.matchedTheme}" class="text-xs text-gray-400" th:text="'Matched theme: ' + ${result.matchedTheme}">Matched theme</span>
                    </div>
                    <div class="text-gray-900 whitespace-pre-wrap" th:text="${result.problem.statement}">Problem statement</div>
                </div>
                <div class="text-right">
                    <div class="text-xs text-gray-500">Score</div>
                    <div class="text-sm font-medium text-gray-700" th:text="${#numbers.formatDecimal(result.score * 100, 0, 0)} + '%'">85%</div>
                </div>
            </div>
            <div class="mt-3">
                <a th:href="@{/problems/{id}(id=${result.problem.id})}" class="text-indigo-600 hover:text-indigo-800 text-sm font-medium">
                    View problem + solution â†’
                </a>
            </div>
        </div>

        <!-- Pagination -->
        <div th:if="${problems.totalPages > 1}" class="mt-6 flex items-center justify-between">
            <div class="text-sm text-gray-700">
                Showing <span th:text="${problems.number * problems.size + 1}">1</span> to
                <span th:text="${problems.number * problems.size + problems.numberOfElements}">20</span> of
                <span th:text="${problems.totalElements}">100</span> problems
            </div>
            <div class="flex space-x-2">
                <a th:unless="${problems.first}"
                   th:href="@{/lectures/{id}/problems(id=${lecture.id}, page=${problems.number - 1}, size=${problems.size}, topK=${topK})}"
                   class="px-4 py-2 border rounded-md text-sm hover:bg-gray-100 transition">Previous</a>
                <span class="px-4 py-2 text-sm text-gray-500">
                    Page <span th:text="${problems.number + 1}">1</span> of <span th:text="${problems.totalPages}">10</span>
                </span>
                <a th:unless="${problems.last}"
                   th:href="@{/lectures/{id}/problems(id=${lecture.id}, page=${problems.number + 1}, size=${problems.size}, topK=${topK})}"
                   class="px-4 py-2 border rounded-md text-sm hover:bg-gray-100 transition">Next</a>
            </div>
        </div>
    </div>
</div>
</body>
</html>
