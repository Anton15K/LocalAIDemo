<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      th:replace="~{layout/base :: html(pageTitle='Recommended Problems', currentPage='lectures', content=~{::content})}">
<body>
<div th:fragment="content">
    <!-- Header -->
    <div class="mb-6">
        <nav class="flex mb-4" aria-label="Breadcrumb">
            <ol class="flex items-center space-x-2">
                <li><a href="/lectures" style="color: var(--muted)" class="hover:opacity-90">Lectures</a></li>
                <li><span class="text-gray-400">/</span></li>
                <li><a th:href="@{/lectures/{id}(id=${lecture.id})}" style="color: var(--muted)" class="hover:opacity-90" th:text="${lecture.title}">Lecture</a></li>
                <li><span class="text-gray-400">/</span></li>
                <li class="font-medium" style="color: var(--text)">Recommended Problems</li>
            </ol>
        </nav>
        <div class="flex items-start justify-between">
            <div>
                <h1 class="text-2xl font-bold" style="color: var(--text)">Recommended Problems</h1>
                <p class="mt-1 text-sm" style="color: var(--muted)">
                    For: <span class="font-medium" style="color: var(--text)" th:text="${lecture.title}">Lecture</span>
                </p>
            </div>
            <a th:href="@{/lectures/{id}(id=${lecture.id})}" class="px-4 py-2 rounded-md transition text-sm ring-1 ring-white/10 hover:bg-white/5" style="color: var(--text)">
                Back to Lecture
            </a>
        </div>
    </div>

    <div th:if="${#lists.isEmpty(problems.content)}" class="ai-surface rounded-lg p-10 text-center">
        <h3 class="text-sm font-medium" style="color: var(--text)">No problems found</h3>
        <p class="mt-1 text-sm" style="color: var(--muted)">Try re-analyzing the lecture or increasing topK.</p>
    </div>

    <div th:unless="${#lists.isEmpty(problems.content)}" class="space-y-4">
        <div th:each="result : ${problems.content}" class="ai-surface rounded-lg p-5">
            <div class="flex items-start justify-between gap-4">
                <div class="flex-1">
                    <div class="flex flex-wrap items-center gap-2 mb-2">
                        <span class="px-2 py-1 rounded-full text-xs font-medium" style="background: rgba(167,139,250,0.12); color: var(--violet); border: 1px solid rgba(167,139,250,0.18)" th:text="${result.problem.topic}">Topic</span>
                        <span th:if="${result.problem.subtopic}" class="px-2 py-1 rounded-full text-xs" style="background: rgba(255,255,255,0.06); color: var(--text); border: 1px solid var(--border)" th:text="${result.problem.subtopic}">Subtopic</span>
                        <span th:if="${result.problem.difficulty}" class="text-xs" style="color: rgba(229,231,235,0.45)" th:text="'Level ' + ${result.problem.difficulty}">Level</span>
                        <span th:if="${result.matchedTheme}" class="text-xs" style="color: rgba(229,231,235,0.45)" th:text="'Matched theme: ' + ${result.matchedTheme}">Matched theme</span>
                    </div>
                    <div class="whitespace-pre-wrap" style="color: var(--text)" th:text="${result.problem.statement}">Problem statement</div>
                </div>
                <div class="text-right">
                    <div class="text-xs" style="color: var(--muted)">Score</div>
                    <div class="text-sm font-medium" style="color: var(--text)" th:text="${#numbers.formatDecimal(result.score * 100, 0, 0)} + '%'">85%</div>
                </div>
            </div>
            <div class="mt-3">
                <a th:href="@{/problems/{id}(id=${result.problem.id})}" class="ai-accent hover:opacity-90 text-sm font-medium">
                    View problem + solution â†’
                </a>
            </div>
        </div>

        <!-- Pagination -->
        <div th:if="${problems.totalPages > 1}" class="mt-6 flex items-center justify-between">
            <div class="text-sm" style="color: var(--muted)">
                Showing <span th:text="${problems.number * problems.size + 1}">1</span> to
                <span th:text="${problems.number * problems.size + problems.numberOfElements}">20</span> of
                <span th:text="${problems.totalElements}">100</span> problems
            </div>
            <div class="flex space-x-2">
                <a th:unless="${problems.first}"
                   th:href="@{/lectures/{id}/problems(id=${lecture.id}, page=${problems.number - 1}, size=${problems.size}, topK=${topK})}"
                   class="px-4 py-2 rounded-md text-sm transition ring-1 ring-white/10 hover:bg-white/5" style="color: var(--text)">Previous</a>
                <span class="px-4 py-2 text-sm" style="color: var(--muted)">
                    Page <span th:text="${problems.number + 1}">1</span> of <span th:text="${problems.totalPages}">10</span>
                </span>
                <a th:unless="${problems.last}"
                   th:href="@{/lectures/{id}/problems(id=${lecture.id}, page=${problems.number + 1}, size=${problems.size}, topK=${topK})}"
                   class="px-4 py-2 rounded-md text-sm transition ring-1 ring-white/10 hover:bg-white/5" style="color: var(--text)">Next</a>
            </div>
        </div>
    </div>
</div>
</body>
</html>
